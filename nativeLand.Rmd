---
title: "NativeLand"
author: "Brian Yandell"
date: "2024-10-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This began as a 
[Python to R Conversion](https://www.codeconvert.ai/python-to-r-converter)
from a student project.
See
[native-land.ca API](https://native-land.ca/resources/api-docs/)
for source material.
See also 
[Simple feature geometry](https://tmieno2.github.io/R-as-GIS-for-Economists/simple-feature-geometry-simple-feature-geometry-list-column-and-simple-feature.html)
from
[R as GIS for Economists](https://tmieno2.github.io/R-as-GIS-for-Economists/).

Issues

- Labels are not working properly.
- Search using `Slug` column (lower case, with `-` for spaces)

This uses
[sf](https://r-spatial.github.io/sf/)
and
[httr](https://httr.r-lib.org/)
R libraries, as well as
[tidyverse](https://www.tidyverse.org/).

The
[native-land.ca](https://native-land.ca/resources/api-docs/)
just reorganized their API.
I have put my API key in folder `data` local to my computer.
You can cut and paste your own

```{r eval=FALSE}
if(!dir.exists("data") dir.create("data"))
saveRDS(readline(), "data/nativeLandKey.rds")
```

```{r}
nativeLandKey <- readRDS("data/nativeLandKey.rds")
```

### Full downloads

Get full downloads at <https://api-docs.native-land.ca/full-geojsons>
using your own key.
I have done that and put entries in my (local) `data` folder.
Here I read those GeoJSON files into a `sf` data frame.

I save this locally for my own possible use.
This object is **NOT** used in the package, nor is it
saved to
[github](https://github.com/byandell-Tribal/nativeLand).

```{r}
nativeLandData <- dplyr::bind_rows(
  territories = nativeLand::features_reform(
    rjson::fromJSON(file = "data/territories")$features),
  languages   = nativeLand::features_reform(
    rjson::fromJSON(file = "data/languages")$features),
  treaties    = nativeLand::features_reform(
    rjson::fromJSON(file = "data/treaties")$features),
  .id = "category")
```

```{r eval=FALSE}
saveRDS(nativeLandData, "data/NativeLandData.rds")
```

### Native Land Slug (lookup names)

The `nativeLandSlug` only has `category` and `Slug`,
useful for name lookups later. 
It would be nice if `native-land.ca` had this directly.

```{r}
nativeLandSlug <- dplyr::select(nativeLandData, category, Slug)
nativeLandSlug$geometry <- NULL
saveRDS(nativeLandSlug, "data/NativeLandSlug.rds")
```

This file is saved locally, and used in the shiny app
[nativeLand::nativeLandApp()].
However, it is not saved to github.
As constructed, it include only the `category` and `Slug`
columns from
[native-land.ca](https://native-land.ca/resources/api-docs/).

### Query for particlar territory, language and treaty combinations

This pulls all entries involving `akota` (Lakota and Nakota languages),
`sioux` (Oceti Sakowin Sioux) and `laramie` (Fort Laramie treaties).

```{r}
dplyr::filter(nativeLandSlug, grepl("akota|sioux|laramie", Slug))
```

### Plot Oceti Sakowin and Lakota Lands

This plots the Oceti Sakowin territories, languages and treaties
maps from `native-land.ca`, either together or on separate facets.

```{r}
oceti_sakowin <- dplyr::filter(nativeLandData,
                               grepl("akota|sioux|laramie", Slug))
```

```{r}
nativeLand::ggplot_nativeLand(oceti_sakowin)
```

```{r}
nativeLand::ggplot_nativeLand(oceti_sakowin, wrap = TRUE)
```

### Menominee Lands

```{r}
menominee <- dplyr::filter(nativeLandData,
                           grepl("menominee", Slug))
```

```{r}
nativeLand::ggplot_nativeLand(menominee)
```

### Direct request

The `get_nativeLand` uses the `native-land.ca` API along with the key.
The challenge is you need to know the Slug exactly,
or use a lookup data frame such as `nativeLandSlug`.

```{r}
nativeLand::get_nativeLand("territories", "oceti", nativeLandKey)
```

```{r}
nativeLand::ggplot_nativeLand(
  nativeLand::get_nativeLand("territories", "oceti-sakowin-sioux",
                           nativeLandKey))
```

```{r}
nativeLand::ggplot_nativeLand(
  nativeLand::get_nativeLand("territories", "oceti",
                             nativeLandKey, nativeLandSlug))
```
